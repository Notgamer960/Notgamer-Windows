local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

local function TweenTeleport(targetCFrame, duration)
	local tweenInfo = TweenInfo.new(duration or 1, Enum.EasingStyle.Linear, Enum.EasingDirection.Out)
	local tween = TweenService:Create(HumanoidRootPart, tweenInfo, {CFrame = targetCFrame})
	tween:Play()
	tween.Completed:Wait()
end

local nearestCoal
local shortestDist = math.huge
for _, coal in ipairs(Workspace.Items:GetChildren()) do
	if coal.Name == "Coal" and coal:IsA("Model") and coal:FindFirstChild("PrimaryPart") then
		local dist = (HumanoidRootPart.Position - coal.PrimaryPart.Position).Magnitude
		if dist < shortestDist then
			shortestDist = dist
			nearestCoal = coal
		end
	end
end

if nearestCoal then
	TweenTeleport(nearestCoal.PrimaryPart.CFrame * CFrame.new(0, 5, 0), 2)

	ReplicatedStorage.RemoteEvents.RequestStartDraggingItem:FireServer(nearestCoal)

	ReplicatedStorage.RemoteEvents.RequestBagStoreItem:InvokeServer(
		LocalPlayer.Inventory:FindFirstChild("Old Sack"),
		ReplicatedStorage.TempStorage.Coal
	)

	ReplicatedStorage.RemoteEvents.StopDraggingItem:FireServer(ReplicatedStorage.TempStorage.Coal)

	-- teleport (tween) to Campground.Mainfire
	local campfire = Workspace:WaitForChild("Campground"):WaitForChild("Mainfire")
	TweenTeleport(campfire.CFrame * CFrame.new(0, 5, 0), 2)

	ReplicatedStorage.RemoteEvents.RequestBagDropItem:FireServer(
		LocalPlayer.Inventory:FindFirstChild("Old Sack"),
		getNil("Coal", "Model"),
		true
	)
end
